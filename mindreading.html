<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Mind Reader - Quantum Edition</title>
    
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>

    <style>
        /* 自定義滾動條 */
        .custom-scrollbar::-webkit-scrollbar { width: 4px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: rgba(0,0,0,0.1); }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: rgba(139, 92, 246, 0.3); border-radius: 4px; }
        
        /* 動畫定義 */
        @keyframes scan {
            0% { top: 0%; opacity: 0; }
            10% { opacity: 1; }
            90% { opacity: 1; }
            100% { top: 100%; opacity: 0; }
        }
        @keyframes pulse-ring {
            0% { transform: scale(0.8); opacity: 0.5; }
            100% { transform: scale(1.3); opacity: 0; }
        }
        @keyframes float {
            0% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
            100% { transform: translateY(0px); }
        }
        
        .animate-scan { animation: scan 2s linear infinite; }
        .animate-pulse-ring { animation: pulse-ring 2s cubic-bezier(0.215, 0.61, 0.355, 1) infinite; }
        .animate-float { animation: float 6s ease-in-out infinite; }

        /* 禁止選取文字，增加 App 質感 */
        body { -webkit-user-select: none; user-select: none; -webkit-tap-highlight-color: transparent; }
    </style>
</head>
<body class="bg-[#0f172a] text-white min-h-screen overflow-hidden font-sans">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // --- 震動反饋輔助函數 ---
        const triggerHaptic = (pattern = [10]) => {
            if (navigator.vibrate) {
                navigator.vibrate(pattern);
            }
        };

        // --- 圖示組件 ---
        const Icons = {
            Sparkles: ({ className }) => (<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z"/><path d="M5 3v4"/><path d="M9 3v4"/><path d="M3 9h4"/><path d="M3 5h4"/></svg>),
            Refresh: ({ className }) => (<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"/><path d="M21 3v5h-5"/><path d="M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"/><path d="M8 16H3v5"/></svg>),
            Fingerprint: ({ className }) => (<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="1.5" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M2 12C2 6.5 6.5 2 12 2a10 10 0 0 1 8 6"/><path d="M5 15.1a7 7 0 0 0 10.9-4"/><path d="M6.3 10.9a3.5 3.5 0 0 1 5.9-1"/><path d="M19.5 11.1c.1 1.7-.5 3.3-1.6 4.6"/><path d="M9.9 19a4.8 4.8 0 0 1-3.6-.9"/><path d="M14.9 16.5a6.4 6.4 0 0 1-2.9 2"/><path d="M12 22v-3"/><path d="M8 22v-1"/><path d="M16 22v-1"/></svg>),
            ArrowRight: ({ className }) => (<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M5 12h14"/><path d="m12 5 7 7-7 7"/></svg>),
            Lock: ({ className }) => (<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><rect width="18" height="11" x="3" y="11" rx="2" ry="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/></svg>),
        };

        // --- 秘密控制面板 (Pro Feature) ---
        const SecretPanel = ({ symbols, onSelect, onClose, currentForced }) => (
            <div className="absolute inset-0 z-[100] bg-slate-900/95 backdrop-blur-md flex flex-col items-center justify-center animate-[fadeIn_0.3s_ease-out]">
                <div className="bg-slate-800 p-6 rounded-2xl border border-red-500/30 shadow-2xl w-[90%] max-w-sm">
                    <h3 className="text-xl font-bold text-red-400 mb-6 flex items-center justify-center gap-2">
                        <Icons.Lock className="w-5 h-5"/> Force Selection
                    </h3>
                    <div className="grid grid-cols-5 gap-3 mb-6">
                        <button 
                            onClick={() => { triggerHaptic([50]); onSelect(null); }}
                            className={`aspect-square rounded-xl border-2 flex items-center justify-center text-sm font-bold transition-all
                            ${currentForced === null ? 'border-red-500 bg-red-500/20 text-white' : 'border-slate-700 text-slate-500'}`}
                        >
                            OFF
                        </button>
                        {symbols.map(s => (
                            <button 
                                key={s}
                                onClick={() => { triggerHaptic([50]); onSelect(s); }}
                                className={`aspect-square rounded-xl border-2 flex items-center justify-center text-xl transition-all
                                ${currentForced === s ? 'border-amber-400 bg-amber-400/20 text-amber-300 shadow-[0_0_10px_rgba(251,191,36,0.3)]' : 'border-slate-700 text-slate-400 hover:bg-slate-700'}`}
                            >
                                {s}
                            </button>
                        ))}
                    </div>
                    <button onClick={onClose} className="w-full py-3 bg-slate-700 rounded-xl text-slate-300 font-medium active:scale-95 transition-transform">
                        Close Panel
                    </button>
                </div>
            </div>
        );

        // --- 掃描動畫組件 ---
        const ScanningOverlay = () => (
            <div className="absolute inset-0 z-20 flex flex-col items-center justify-center bg-slate-900/90 backdrop-blur-sm animate-[fadeIn_0.5s]">
                <div className="relative w-32 h-32 mb-8">
                    {/* 脈衝光環 */}
                    <div className="absolute inset-0 rounded-full border-2 border-indigo-500/30 animate-pulse-ring"></div>
                    <div className="absolute inset-0 rounded-full border-2 border-indigo-500/30 animate-pulse-ring" style={{animationDelay: '1s'}}></div>
                    
                    {/* 核心圖示 */}
                    <div className="absolute inset-0 flex items-center justify-center text-indigo-400 drop-shadow-[0_0_10px_rgba(99,102,241,0.5)]">
                        <Icons.Fingerprint className="w-16 h-16 animate-pulse" />
                    </div>
                    
                    {/* 掃描線 */}
                    <div className="absolute left-0 right-0 h-1 bg-indigo-400/50 blur-[2px] shadow-[0_0_10px_#818cf8] animate-scan"></div>
                </div>
                <div className="text-center space-y-2">
                    <h3 className="text-xl font-bold text-white tracking-widest uppercase">Analyzing</h3>
                    <p className="text-indigo-300/70 text-sm font-mono animate-pulse">Reading mental projection...</p>
                </div>
            </div>
        );

        function MindReader() {
            const [step, setStep] = useState(0);
            const [isScanning, setIsScanning] = useState(false);
            
            // Magic State
            const [magicMode, setMagicMode] = useState(false);
            const [forcedSymbol, setForcedSymbol] = useState(null);
            const [showSecretPanel, setShowSecretPanel] = useState(false);

            // Game State
            const [targetSymbol, setTargetSymbol] = useState(null);
            const [grid, setGrid] = useState([]);
            
            const symbols = ['★', '♥', '♠', '♦', '♣', '☀', '☾', '⚛', '☯', '☮', 'Ω', 'Σ', 'Ψ', '∞', '∇'];

            // 初始化遊戲邏輯
            const initGame = () => {
                let winningSymbol;
                if (forcedSymbol) winningSymbol = forcedSymbol;
                else if (magicMode) winningSymbol = '★'; // Default magic symbol
                else winningSymbol = symbols[Math.floor(Math.random() * symbols.length)];

                setTargetSymbol(winningSymbol);

                let newGrid = [];
                for (let i = 0; i < 100; i++) {
                    if (i % 9 === 0) newGrid.push({ num: i, sym: winningSymbol });
                    else {
                        let randomSym;
                        do {
                            randomSym = symbols[Math.floor(Math.random() * symbols.length)];
                        } while (randomSym === winningSymbol);
                        newGrid.push({ num: i, sym: randomSym });
                    }
                }
                setGrid(newGrid);
            };

            // 當進入選擇頁面時，初始化數據
            useEffect(() => {
                if (step === 2) initGame();
            }, [step]);

            // 處理步驟轉換
            const handleNext = () => {
                triggerHaptic([15]); // 輕微震動

                if (step === 2) {
                    // 進入掃描階段
                    setIsScanning(true);
                    triggerHaptic([30, 50, 30]); // 掃描開始震動
                    setTimeout(() => {
                        setIsScanning(false);
                        setStep(3);
                        triggerHaptic([100, 50, 100]); // 結果揭曉震動
                    }, 3500); // 3.5秒的表演時間
                } else if (step < 3) {
                    setStep(step + 1);
                } else {
                    setStep(0);
                }
            };

            // Magic Triggers
            const toggleMagicMode = (e) => {
                e.stopPropagation();
                triggerHaptic([10]);
                setMagicMode(prev => !prev);
            };

            // 動態標題樣式 - 這是隱藏的指示器
            // 正常：紫色漸層
            // 強選開啟：極微小的金色偏移，只有魔術師看得出來
            const titleStyle = forcedSymbol 
                ? "bg-gradient-to-r from-purple-200 via-amber-100 to-indigo-200" 
                : "bg-gradient-to-r from-purple-300 via-indigo-200 to-indigo-300";

            return (
                <div className="relative min-h-screen flex flex-col items-center justify-center p-6 overflow-hidden">
                    
                    {/* 背景動態粒子 (純 CSS) */}
                    <div className="absolute inset-0 pointer-events-none opacity-20">
                         {[...Array(6)].map((_, i) => (
                            <div key={i} 
                                className="absolute rounded-full blur-3xl animate-float"
                                style={{
                                    left: `${Math.random() * 100}%`,
                                    top: `${Math.random() * 100}%`,
                                    width: `${200 + Math.random() * 300}px`,
                                    height: `${200 + Math.random() * 300}px`,
                                    background: i % 2 === 0 ? '#4f46e5' : '#7c3aed',
                                    animationDuration: `${10 + Math.random() * 10}s`,
                                    animationDelay: `${Math.random() * -10}s`
                                }}
                            />
                        ))}
                    </div>

                    {/* Secret Panel */}
                    {showSecretPanel && (
                        <SecretPanel 
                            symbols={symbols} 
                            onSelect={(s) => { setForcedSymbol(s); if(s) setShowSecretPanel(false); }} 
                            onClose={() => setShowSecretPanel(false)}
                            currentForced={forcedSymbol}
                        />
                    )}

                    {/* Header Area */}
                    <div className="z-10 w-full max-w-md flex justify-between items-center mb-8 relative">
                        {/* 隱形觸發區：左上角水晶球 */}
                        <div 
                            onClick={toggleMagicMode}
                            className={`p-2 rounded-full transition-all duration-700 ${magicMode ? 'text-amber-300 drop-shadow-[0_0_8px_rgba(251,191,36,0.6)]' : 'text-slate-600 hover:text-slate-500'}`}
                        >
                            <Icons.Sparkles className="w-6 h-6" />
                        </div>

                        {/* 隱形觸發區：標題 (雙擊) */}
                        <h1 
                            onDoubleClick={() => setShowSecretPanel(true)}
                            className={`text-2xl font-black tracking-widest uppercase bg-clip-text text-transparent cursor-default transition-all duration-500 ${titleStyle}`}
                        >
                            Mind Reader
                        </h1>

                        <div className="w-10"></div> {/* 佔位符保持標題置中 */}
                    </div>

                    {/* Main Card */}
                    <div className="z-10 w-full max-w-md bg-slate-800/40 backdrop-blur-xl border border-white/10 rounded-3xl p-8 shadow-2xl relative overflow-hidden min-h-[420px] flex flex-col">
                        
                        {/* 掃描層 */}
                        {isScanning && <ScanningOverlay />}

                        {/* Step 0: Intro */}
                        {step === 0 && (
                            <div className="flex-1 flex flex-col items-center justify-center space-y-8 animate-[fadeIn_0.6s_ease-out]">
                                <div className="relative">
                                    <div className="absolute inset-0 bg-indigo-500 blur-2xl opacity-20 animate-pulse"></div>
                                    <Icons.Fingerprint className="w-24 h-24 text-indigo-400 relative z-10" />
                                </div>
                                <div className="text-center space-y-3">
                                    <h2 className="text-2xl font-bold text-white">量子讀心術</h2>
                                    <p className="text-indigo-200/70 text-sm leading-relaxed max-w-[260px] mx-auto">
                                        透過演算法解析潛意識的微表情。<br/>請放鬆，讓我連結你的思緒。
                                    </p>
                                </div>
                                <button 
                                    onClick={handleNext}
                                    className="group relative px-8 py-3 bg-indigo-600 hover:bg-indigo-500 rounded-full font-bold tracking-wide transition-all hover:scale-105 active:scale-95 shadow-[0_0_20px_rgba(79,70,229,0.4)]"
                                >
                                    開始連結
                                    <div className="absolute inset-0 rounded-full bg-white/20 animate-pulse-ring opacity-0 group-hover:opacity-100"></div>
                                </button>
                            </div>
                        )}

                        {/* Step 1: Instruction */}
                        {step === 1 && (
                            <div className="flex-1 flex flex-col animate-[slideInRight_0.4s_ease-out]">
                                <div className="flex-1 space-y-6">
                                    <div className="flex items-center gap-3 text-indigo-400 mb-2">
                                        <div className="w-8 h-8 rounded-full bg-indigo-500/20 flex items-center justify-center font-bold">1</div>
                                        <h3 className="font-bold text-white">數學共振</h3>
                                    </div>
                                    <ul className="space-y-4 text-slate-300 text-sm leading-relaxed bg-black/20 p-5 rounded-2xl border border-white/5">
                                        <li className="flex gap-3">
                                            <span className="text-indigo-400">➢</span>
                                            <span>心中想一個 <strong className="text-white">兩位數</strong> <span className="text-slate-500">(例: 23)</span></span>
                                        </li>
                                        <li className="flex gap-3">
                                            <span className="text-indigo-400">➢</span>
                                            <span>將這兩個數字相加 <span className="text-slate-500">(2 + 3 = 5)</span></span>
                                        </li>
                                        <li className="flex gap-3">
                                            <span className="text-indigo-400">➢</span>
                                            <span>用原數字減去相加結果 <span className="text-slate-500">(23 - 5 = 18)</span></span>
                                        </li>
                                        <li className="flex gap-3 pt-2 border-t border-white/10">
                                            <span className="text-amber-400">★</span>
                                            <span className="text-white font-bold">記住最後得到的數字！</span>
                                        </li>
                                    </ul>
                                </div>
                                <button 
                                    onClick={handleNext}
                                    className="w-full py-4 mt-6 bg-slate-700/50 hover:bg-slate-700 border border-white/10 rounded-xl font-semibold flex items-center justify-center gap-2 transition-all active:scale-95 group"
                                >
                                    我記住了
                                    <Icons.ArrowRight className="w-4 h-4 group-hover:translate-x-1 transition-transform" />
                                </button>
                            </div>
                        )}

                        {/* Step 2: Grid */}
                        {step === 2 && (
                            <div className="flex-1 flex flex-col h-full animate-[fadeIn_0.5s]">
                                <div className="text-center mb-4">
                                    <p className="text-sm text-indigo-200">找到你的數字，<span className="text-amber-300 font-bold">專注看著旁邊的符號</span></p>
                                </div>
                                <div className="flex-1 overflow-y-auto grid grid-cols-5 gap-2 pr-1 custom-scrollbar mask-image-gradient">
                                    {grid.map((item) => (
                                        <div key={item.num} className="aspect-square flex flex-col items-center justify-center rounded-lg bg-slate-700/30 border border-white/5">
                                            <span className="text-[10px] text-slate-500 font-mono mb-1">{item.num}</span>
                                            <span className="text-lg text-white font-serif">{item.sym}</span>
                                        </div>
                                    ))}
                                </div>
                                <button 
                                    onClick={handleNext}
                                    className="w-full py-4 mt-4 bg-indigo-600 hover:bg-indigo-500 rounded-xl font-bold shadow-lg shadow-indigo-900/50 transition-all active:scale-95"
                                >
                                    讀取我的心思
                                </button>
                            </div>
                        )}

                        {/* Step 3: Reveal */}
                        {step === 3 && (
                            <div className="flex-1 flex flex-col items-center justify-center animate-[zoomIn_0.5s_cubic-bezier(0.175,0.885,0.32,1.275)]">
                                <div className="relative group cursor-pointer">
                                    <div className="absolute inset-0 bg-amber-400 blur-[80px] opacity-20 group-hover:opacity-40 transition-opacity duration-1000"></div>
                                    <div className="relative z-10 text-[100px] leading-none font-serif text-transparent bg-clip-text bg-gradient-to-br from-amber-100 to-amber-400 drop-shadow-[0_0_30px_rgba(251,191,36,0.4)] transform group-hover:scale-110 transition-transform duration-500">
                                        {targetSymbol}
                                    </div>
                                </div>
                                
                                <div className="mt-12 text-center space-y-2">
                                    <h3 className="text-white text-lg font-medium tracking-wide">你的心思是...</h3>
                                    <p className="text-slate-400 text-xs">Mental Connection Established</p>
                                </div>

                                <button 
                                    onClick={handleNext}
                                    className="mt-12 px-6 py-2 rounded-full border border-white/10 text-slate-400 hover:text-white hover:bg-white/5 transition-colors flex items-center gap-2 text-sm"
                                >
                                    <Icons.Refresh className="w-4 h-4" />
                                    再次連結
                                </button>
                            </div>
                        )}
                    </div>

                    <div className="mt-6 text-slate-600 text-[10px] tracking-widest opacity-50 font-mono">
                        QUANTUM MIND READER v2.0
                    </div>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<MindReader />);
    </script>
</body>
</html>
